---
role_name_check: 1
dependency:
  name: galaxy
  options:
    ignore-errors: true
    ignore-certs: true
    role-file: requirements.yml
driver:
  name: docker
platforms:
  - name: instance
    image: "bsmeding/ansible_cicd_${MOLECULE_DISTRO:-ubuntu2204}:latest"
    command: ${MOLECULE_DOCKER_COMMAND:-"/sbin/init"}
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    cgroupns_mode: host
    tmpfs:
      - /run
      - /run/lock
      - /tmp:rw,size=100M,mode=1777
    environment:
      container: docker
    privileged: true
    pre_build_image: true
    published_ports:
      - "8080:80"
    # environment:
    #   DOCKER_HOST: unix:///var/run/docker.sock
    capabilities:
      - SYS_ADMIN
      - NET_ADMIN
      - SYS_CHROOT
      - SETGID
      - SETUID
      - DAC_OVERRIDE
      - CHOWN
      - FOWNER
      - MKNOD
      - NET_BIND_SERVICE
      - SYS_BOOT
      - SYS_RESOURCE
      - SYS_TIME
      - SYS_TTY_CONFIG
      - AUDIT_WRITE
      - MAC_OVERRIDE
      - MAC_ADMIN
      - SYSLOG
      - WAKE_ALARM
      - BLOCK_SUSPEND
      - LEASE
provisioner:
  name: ansible
  playbooks:
    converge: ${MOLECULE_PLAYBOOK:-converge.yml}
    verify: ${MOLECULE_PLAYBOOK_VERIFY:-verify.yml}
  config_options:
    defaults:
      remote_tmp: /tmp/.ansible
      roles_path: "../../../"
